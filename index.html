<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP cURL Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @media (max-width: 768px) {
            .max-w-xl {
                width: 90%;
            }
        }

        body, textarea, pre {
            font-family: 'Inter', sans-serif;
        }

        textarea, pre {
            padding: 1rem;
        }

        textarea {
            resize: none;
        }

        .title {
            font-family: 'Kaushan Script', cursive;
        }

        .form-checkbox:checked {
            background-color: #4f46e5;
            border-color: transparent;
        }

        .form-checkbox:focus {
            ring-color: #4f46e5;
        }

        .form-checkbox {
            color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col justify-center items-center py-8">
    <div class="max-w-xl w-full px-4 py-6 bg-gray-800 shadow-lg rounded-lg relative">
        <h1 class="text-3xl font-bold mb-6 text-center title">PHP cURL Converter</h1>
        <div class="mb-4 relative">
            <textarea id="httpRequestInput"
                class="w-full h-40 rounded-lg border border-gray-700 bg-gray-600 focus:outline-none focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-gray-200 placeholder-gray-400"
                placeholder="Paste your HTTP request here"></textarea>
            <div class="absolute top-0 right-0 mt-3 mr-3 flex space-x-2">
                <button type="button" id="pasteButton"
                    class="bg-gray-600 rounded-full p-2 hover:bg-gray-700 focus:bg-gray-700 focus:outline-none transition duration-300">
                    <i class="fas fa-paste text-gray-400 text-lg"></i>
                </button>
                <button type="button" id="resetButton"
                    class="bg-gray-600 rounded-full p-2 hover:bg-gray-700 focus:bg-gray-700 focus:outline-none transition duration-300">
                    <i class="fas fa-undo text-gray-400 text-lg"></i>
                </button>
            </div>
            <div class="mt-4 flex space-x-6">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="cookieCheckbox" class="form-checkbox h-5 w-5 text-indigo-600">
                    <span class="ml-2">Cookie</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="checkbox" id="refererCheckbox" class="form-checkbox h-5 w-5 text-indigo-600">
                    <span class="ml-2">Referer</span>
                </label>
            </div>
        </div>
        <h2 class="text-lg font-semibold mb-2">Converted PHP cURL</h2>
        <div class="relative">
            <pre id="curlOutput"
                class="w-full h-40 overflow-auto bg-gray-600 rounded-lg border border-gray-700 max-h-80 text-gray-200"></pre>
            <button type="button" id="copyButton"
                class="absolute top-2 right-2 bg-gray-600 rounded-full p-2 hover:bg-gray-700 focus:bg-gray-700 focus:outline-none transition duration-300 hidden">
                <i class="fas fa-copy text-gray-400 text-lg"></i>
            </button>
        </div>
    </div>

    <script>
        function processInputText(inputText) {
            const regex = /name="([^"]+)"\s*\r?\n\r?\n([^-\r\n]+)/g;
            const fields = {};
            let match;
            
            while ((match = regex.exec(inputText)) !== null) {
                const name = match[1];
                const value = match[2].trim();
                fields[name] = value;
            }
            
            const params = new URLSearchParams(fields);
            return params.toString();
        }

        function gStr(str, start, end = '') {
            const startPos = str.indexOf(start);
            if (startPos === -1) return '';
            
            const afterStart = str.substring(startPos + start.length);
            
            if (!end) return afterStart;
            
            const endPos = afterStart.indexOf(end);
            return endPos === -1 ? afterStart : afterStart.substring(0, endPos);
        }

        function convertHttpRequestToCurl(httpRequest, includeCookie, includeReferer) {
            // Handle curl command format
            if (httpRequest.includes("curl '")) {
                const urlMatch = httpRequest.match(/curl '([^']+)'/);
                if (!urlMatch) return '';
                
                const url = urlMatch[1];
                const headerMatches = httpRequest.match(/-H '([^']+)'/g) || [];
                const headers = headerMatches.map(h => h.match(/-H '([^']+)'/)[1]);
                
                const urlObj = new URL(url);
                let path = urlObj.pathname;
                if (urlObj.search) path += urlObj.search;
                
                let request = `GET ${path} h2\n`;
                request += `Host: ${urlObj.host}\n`;
                
                headers.forEach(header => {
                    request += `${header}\n`;
                });
                
                if (httpRequest.includes('--data-raw')) {
                    let result = gStr(httpRequest, "--data-raw '", "'");
                    
                    if (!result) {
                        const match = httpRequest.match(/--data-raw \\\$'(.*?)'/);
                        if (match) result = match[1];
                    }
                    
                    if (!result) {
                        const matches = httpRequest.match(/--data-raw '(.*?)'/);
                        if (matches) result = matches[1];
                    }
                    
                    if (result && result.includes('--WebKitFormBoundary')) {
                        result = result.replace(/\\r\\n/g, '\r\n');
                        result = processInputText(result);
                    }
                    
                    if (result) {
                        request += `\n${result}`;
                    }
                }
                
                httpRequest = request;
            }

            const lines = httpRequest.split('\n');
            const curlCode = [];
            
            const pattern = /(POST|GET) (.+?) (HTTP|h2)/;
            let path = '';
            
            for (const line of lines) {
                const match = line.match(pattern);
                if (match) {
                    path = match[2];
                    break;
                }
            }
            
            if (!path) return '';
            
            let host = '';
            for (const line of lines) {
                const match = line.trim().match(/^Host: (.*)$/i);
                if (match) {
                    host = match[1].trim();
                    break;
                }
            }
            
            const pathParts = path.replace(/^\/|\/$/g, '').split('/');
            let variableName = pathParts[pathParts.length - 1];
            
            if (variableName.length > 20 || variableName.includes('.') || variableName.includes('-')) {
                variableName = pathParts[0];
                if (variableName.includes('.')) {
                    variableName = variableName.split('.')[0];
                }
                if (variableName.includes('-')) {
                    variableName = variableName.split('-')[0];
                }
                if (variableName.includes('?')) {
                    variableName = variableName.split('?')[0];
                }
            }
            
            curlCode.push(`$ch = curl_init("https://${host}${path}");`);
            curlCode.push('curl_setopt($ch, CURLOPT_HEADER, 0);');
            curlCode.push('curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);');
            curlCode.push('curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);');
            curlCode.push('curl_setopt($ch, CURLOPT_COOKIEFILE, $cookie);');
            curlCode.push('curl_setopt($ch, CURLOPT_COOKIEJAR, $cookie);');
            
            const postFields = [];
            const headers = [];
            const cookies = [];
            const referers = [];
            let isPostFieldSection = false;
            
            // Headers to exclude
            const excludedHeaders = [
                'host',
                'content-length',
                'x-requested-with',
                'accept',
                'sec-ch-ua-mobile',
                'sec-ch-ua-platform',
                'sec-ch-ua',
                'sec-gpc',
                'accept-language',
                'origin',
                'sec-fetch-site',
                'sec-fetch-mode',
                'sec-fetch-dest',
                'accept-encoding',
                'priority',
                'cache-control',
                'upgrade-insecure-requests',
                'sec-fetch-user',
                
            ];
            
            for (const line of lines) {
                if (line.trim() === '') {
                    isPostFieldSection = true;
                    continue;
                }
                
                if (isPostFieldSection) {
                    postFields.push(line.trim());
                } else {
                    const headerMatch = line.trim().match(/^([^:]+): (.*)$/i);
                    
                    if (headerMatch) {
                        const headerName = headerMatch[1].trim().toLowerCase();
                        const headerValue = headerMatch[2].trim();
                        
                        // Check if it's cookie (optional)
                        if (headerName === 'cookie') {
                            if (includeCookie) {
                                cookies.push(headerValue);
                            }
                        }
                        // Check if it's referer (optional)
                        else if (headerName === 'referer') {
                            if (includeReferer) {
                                referers.push(headerValue);
                            }
                        }
                        // Skip excluded headers
                        else if (!excludedHeaders.includes(headerName)) {
                            // Handle content-type specially for WebKitFormBoundary
                            if (headerName === 'content-type' && httpRequest.includes('--WebKitFormBoundary')) {
                                headers.push('content-type: application/x-www-form-urlencoded');
                            } else {
                                headers.push(`${headerName}: ${headerValue}`);
                            }
                        }
                    }
                }
            }
            
            let postfield = postFields.join('&');
            if (postfield.includes('--WebKitFormBoundary')) {
                postfield = processInputText(httpRequest);
            }
            
            if (cookies.length > 0) {
                headers.push(`cookie: ${cookies.join('; ')}`);
            }
            
            if (referers.length > 0) {
                headers.push(`referer: ${referers.join('; ')}`);
            }
            
            if (headers.length > 0) {
                curlCode.push('curl_setopt($ch, CURLOPT_HTTPHEADER, [');
                headers.forEach(header => {
                    curlCode.push(`    '${header}',`);
                });
                curlCode.push(']);');
            }
            
            if (postFields.length > 0) {
                if (postfield.includes('"') && postfield.includes("'")) {
                    postfield = postfield.replace(/'/g, "\\'");
                    curlCode.push(`curl_setopt($ch, CURLOPT_POSTFIELDS, '${postfield}');`);
                } else if (postfield.includes('"')) {
                    curlCode.push(`curl_setopt($ch, CURLOPT_POSTFIELDS, '${postfield}');`);
                } else if (postfield.includes("'")) {
                    curlCode.push(`curl_setopt($ch, CURLOPT_POSTFIELDS, "${postfield}");`);
                } else {
                    curlCode.push(`curl_setopt($ch, CURLOPT_POSTFIELDS, "${postfield}");`);
                }
            }
            
            if (!variableName) {
                variableName = 'response';
            }
            variableName = variableName.replace(/\?/g, '').replace(/=/g, '');
            
            curlCode.push(`$${variableName} = curl_exec($ch);`);
            curlCode.push('curl_close($ch);');
            
            return curlCode.join('\n');
        }

        function updateCurlCommand() {
            const httpRequest = document.getElementById('httpRequestInput').value;
            const includeCookie = document.getElementById('cookieCheckbox').checked;
            const includeReferer = document.getElementById('refererCheckbox').checked;
            
            const result = convertHttpRequestToCurl(httpRequest, includeCookie, includeReferer);
            
            const curlOutput = document.getElementById('curlOutput');
            curlOutput.textContent = result;
            
            const copyButton = document.getElementById('copyButton');
            if (result.trim() !== '') {
                copyButton.classList.remove('hidden');
            } else {
                copyButton.classList.add('hidden');
            }
        }

        document.getElementById('pasteButton').addEventListener('click', function() {
            navigator.clipboard.readText().then(text => {
                document.getElementById('httpRequestInput').value += text;
                updateCurlCommand();
            }).catch(err => {
                console.error('Failed to read clipboard contents: ', err);
            });
        });

        document.getElementById('copyButton').addEventListener('click', function() {
            const curlOutput = document.getElementById('curlOutput');
            navigator.clipboard.writeText(curlOutput.textContent.trim())
                .then(() => {
                    console.log('Copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        });

        document.getElementById('httpRequestInput').addEventListener('input', updateCurlCommand);
        document.getElementById('cookieCheckbox').addEventListener('change', updateCurlCommand);
        document.getElementById('refererCheckbox').addEventListener('change', updateCurlCommand);

        document.getElementById('resetButton').addEventListener('click', function() {
            document.getElementById('httpRequestInput').value = '';
            document.getElementById('curlOutput').textContent = '';
            document.getElementById('copyButton').classList.add('hidden');
        });
    </script>
</body>
</html>